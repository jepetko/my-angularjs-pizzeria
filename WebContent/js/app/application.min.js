!function(){"use strict";angular.module("orders-services",["ngResource","shared"]).factory("Orders",["$resource",function(a){return a("payment/orders/:id",null,{save:{method:"POST"}})}]).service("OrdersService",["Orders","StringUtils","$timeout",function(a,b,c){this.address={},this.bag={},this.orders=[],this.cleanUp=function(){this.address.payment&&(this.address.payment=b.trim(this.address.payment))},this.getBag=function(){return this.bag},this.clearBag=function(){this.bag={}},this.isBagEmpty=function(){for(var a in this.bag)return!1;return!0},this.getPendingOrders=function(){return a.query(function(a){return function(b){a.orders=b}}(this))},this.sendOrder=function(){this.cleanUp();var b=[];for(var c in this.bag){var d=parseInt(this.bag[c],10),e={product:{id:c},count:d};b.push(e)}var f={items:b,address:this.address};a.save(f,function(a){return function(){a.getPendingOrders()}}(this))},c(function(a){return function(){a.getPendingOrders()}}(this),500)}])}(),function(){"use strict";angular.module("products-services",["ngResource"]).factory("ProductsFactory",["$resource",function(a){return a("shop/products/:id")}]).service("ProductsService",["ProductsFactory",function(a){this.products=[],a.query(function(a){return function(b){angular.forEach(b,function(b){a.products.push(b)})}}(this)),this.getProducts=function(){return this.products}}])}(),angular.module("shared",["ngCookies"]).service("cookieHandler",["$rootScope","$window","$cookies",function(a,b,c){a.$watch(function(){return b.location.href},function(){}),this.get=function(a){return c[a]},this.unset=function(a){delete c[a]}}]).service("StringUtils",[function(){this.trim=function(a){return a?a.replace(/^\s+/g,"").replace(/\s+$/,""):""}}]),function(){"use strict";angular.module("address-app",["ngResource","orders-app"]).directive("validcreditcard",["StringUtils",function(a){return{scope:"=",require:"ngModel",link:function(b,c,d,e){e.$parsers.push(function(a){if(!a)return"";var b=a.match(/^\d+$/)&&16===a.length;return e.$setValidity("creditcard",b),b?a:""}),b.$watch("address.payment",function(c){c&&(c=a.trim(c)),"cash"===c?(e.$setValidity("creditcard",!0),b.address.creditcard=""):e.$setValidity("creditcard",b.address.creditcard&&16===b.address.creditcard.length)})}}}]).controller("AddressCtrl",["$scope","$location","OrdersService","StringUtils",function(a,b,c,d){a.address=c.address,a.payments={visa:"VISA",mastercard:"MasterCard",diners:"Diners",cash:"Cash"},a.creditCardSelected=function(){if(!a.address.payment)return!1;var b=d.trim(a.address.payment);return"cash"!=b},a.isBagEmpty=function(){return $.isEmptyObject(c.bag)},a.btnDisabled=function(){return a.addressForm.$invalid||a.isBagEmpty()},a.submit=function(){c.sendOrder(),b.path("/finish")}}])}(),function(){"use strict";angular.module("finish-app",["shoppingbag-app","orders-app"]).controller("FinishCtrl",["$scope","$filter","OrdersService","ProductsService",function(a,b,c,d){a.products=d.getProducts(),a.msg="",a.getProductName=function(b){var c=null;return angular.forEach(a.products,function(a){""+a.id==""+b&&(c=a.name)}),c},a.createMessage=function(){if(c.isBagEmpty())return"Your bag is empty. Please add some pizzas to your bag.";var d=b("translate")("Thank you for your order. Here is the summary: "),e=c.getBag(),f=0;for(var g in e){f>0&&(d+=", ");var h=e[g];d+=h+"x "+a.getProductName(g),f++}return c.clearBag(),d+"."},a.init=function(){a.msg=a.createMessage()}}])}(),function(){"use strict";angular.module("orders-app",["orders-services"]).controller("OrdersCtrl",["$scope","OrdersService",function(a,b){a.orders=b.getPendingOrders()}])}(),function(){"use strict";angular.module("products-ctrl",["shoppingbag-app"]).filter("nospaces",function(){return function(a){return a.replace(/\s+/g,"")}}).controller("ProductsCtrl",["$scope","ProductsService","OrdersService",function(a,b,c){a.products=b.getProducts(),a.bag=c.getBag()}])}(),function(){"use strict";angular.module("shopping-app",["ngRoute","wizard-components","products-services","products-ctrl","shoppingbag-app","address-app","finish-app"]).config(["$httpProvider","$routeProvider","$locationProvider","$logProvider",function(a,b,c,d){a.interceptors.push(["$q",function(a){var b=function(a){var b=""+a;return 0===b.indexOf("4")||0===b.indexOf("5")};return{response:function(a){return a},responseError:function(c){return b(c.status)&&(location.href="login.jsp"),a.reject(c)}}}]);var e=d.$get;if(e&&e.length&&e.length>1&&"function"==typeof e[1]){var f=e[1],g=f(window),h=g.error;g.error=function(){if(arguments.length>0&&arguments[0].message){var a=new RegExp("missing hash prefix","g");if(a.test(""+arguments[0].message)){var b=[].concat(arguments).slice(1);b.unshift("MISSING HASH PREFIX ISSUE: "+arguments[0].message),g.log.apply(g,b)}else h.apply(g,arguments)}},d.$get=["$window",function(a){return function(){return a}}(g)]}b.when("/select",{templateUrl:"templates/products.html"}).when("/bag",{templateUrl:"templates/bag.html"}).when("/address",{templateUrl:"templates/address.html"}).when("/finish",{templateUrl:"templates/finish.html"}).when("/orders",{templateUrl:"templates/orders.html"}).otherwise({redirectTo:"/select"}),c.hashPrefix("!")}]).controller("AppCtrl",["$scope","OrdersService","cookieHandler","gettextCatalog","$http",function(a,b,c,d,e){a.getOrderCount=function(){return b.orders.length},a.changeLanguage=function(a){d.setCurrentLanguage(a)},a.setUserCredentials=function(b,d){c.get("login")?a.currentUser=c.get("login"):(a.currentUser=b,a.sessionId=d,e.defaults.headers.common.JSESSIONID=d,e.defaults.headers.common.login=b)}}])}(),function(){"use strict";angular.module("shoppingbag-app",["products-services","orders-app"]).controller("ShoppingBagCtrl",["$scope","OrdersService","ProductsService",function(a,b,c){a.bag=b.getBag(),a.all=function(){var b=c.getProducts();a.products={};for(var d=0;d<b.length;d++){var e=b[d],f=e.id;a.products[""+f]=e}},a.getProductById=function(b){return a.products?a.products[b]:{}},a.getTotal=function(b){if(!a.products)return{};var c=a.getProductById(b);return c.price*a.bag[b]},a.getGrandTotal=function(){if(!a.bag)return 0;var b=0;for(var c in a.bag){var d=a.getProductById(c);b+=d.price*a.bag[c]}return b},a.init=function(){this.all()};var d=function(a){return function(b){if(b)for(var c in b)""===b[c]&&delete a.bag[c]}}(a);a.$watch("bag",function(a){d(a)},!0)}])}(),function(){"use strict";angular.module("wizard-components",[]).directive("wizard",["$rootScope","$location",function(a,b){return{scope:{c:"&"},controller:["$scope",function(c){c.pages=[{label:"Choose product",link:"#!/select",css:""},{label:"Your shopping bag",link:"#!/bag",css:""},{label:"Your address",link:"#!/address",css:""},{label:"Finish",link:"#!/finish",css:""},{label:"Orders",link:"#!/orders",css:""}],c.isOrdersTab=function(a){return"Orders"==a},a.$on("$locationChangeSuccess",function(){var a=b.path();angular.forEach(c.pages,function(b){b.css=a===b.link.replace(/^#!/,"")?"active":""})})}],restrict:"E",replace:!0,transclude:!0,template:'<div class="panel panel-default"><div class="panel-body"><ul class="nav nav-pills" role="tablist"><li role="presentation" ng-repeat="p in pages" ng-class="p.css"><a href="{{p.link}}">{{p.label | translate}}<span ng-if="isOrdersTab(p.label)"> ({{c()}})</span></a></li><ul></div></div>'}}])}(),angular.element(window).ready(function(){var a=$("#main");angular.module("pizzeria-app",["gettext","shared","shopping-app","orders-app"]).run(["gettextCatalog",function(a){a.setCurrentLanguage("en"),a.debug=!0}]),angular.bootstrap(a,["pizzeria-app"])}),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("de",{Amount:"Betrag",Count:"Anzahl",Date:"Datum","Done!":"Fertig!","First name":"Vorname","Go!":"Los!","Grand Total":"Gesamtbetrag",Login:"Login",Name:"Name",Password:"Passwort",Price:"Preis","Street / No.":"Stra&szlig;e / Hausnr.",Summary:"Zusammenfassung",Surname:"Nachname",Total:"Gesamt","Your payment method":"Ihre Zahlungsmethode","ZIP / City":"PLZ / Ort","My Awesome Pizzeria":"Meine perfekte Pizzeria","Please, use this wizard to order some pizzas.":"Bitte, folgen Sie unserem Wizard um Pizzen auszuw&auml;hlen.","Choose product":"Produkt auswählen","Your shopping bag":"Ihr Einkaufskorb","Your address":"Ihre Lieferadresse",Finish:"Fertig",Orders:"Bisherige Bestellungen",Margharita:"Margharita",Cardinale:"Cardinale",Prosciuto:"Prosciuto",Tonno:"Tonno","Quattro Stagioni":"Quattro Stagioni","Family Pizza":"Familien-Pizza","Your bag is empty. Please add some pizzas to your bag.":"Ihr Einkaufskorb ist leer. Bitte, fügen Sie Pizzen hinzu.",User:"Benutzer",Logout:"Ausloggen",VISA:"VISA",MasterCard:"MasterCard",Diners:"Diners",Cash:"Bar bei Lieferung","Thank you for your order. Here is the summary: ":"Danke für Ihre Bestellung. Hier ist die Zusammenfassung: ",German:"Deutsch",English:"Englisch","No orders so far.":"Es gibt noch keine Bestelungen.","Please, add some pizzas to your bag.":"Bitte, f&uuml;gen Sie Pizzen Ihrem Warenkorb hinzu."})}]);