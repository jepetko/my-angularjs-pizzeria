/*! my-first-angularjs-pizzeria-tasks - v0.0.1 - 2014-12-10
* Copyright (c) 2014 Katarina Golbang;*/
!function(){"use strict";angular.module("orders-services",["ngResource","shared"]).factory("Orders",["$resource",function(a){return a("payment/orders/:id",null,{save:{method:"POST"}})}]).service("OrdersService",["Orders","StringUtils","$timeout",function(a,b,c){this.address={},this.addressValid=!1,this.currentOrderSent=!1,this.bag={},this.orders=[],this.cleanUp=function(){this.address.payment&&(this.address.payment=b.trim(this.address.payment))},this.getBag=function(){return this.bag},this.resetCurrentOrder=function(){this.bag={},this.currentOrderSent=!1},this.isBagEmpty=function(){for(var a in this.bag)return!1;return!0},this.setAddressValid=function(a){this.addressValid=a},this.isAddressValid=function(){return this.addressValid},this.isCurrentOrderSent=function(){return this.currentOrderSent},this.getPendingOrders=function(){return a.query(function(a){return function(b){a.orders=b}}(this))},this.sendOrder=function(){this.cleanUp();var b=[];for(var c in this.bag){var d=parseInt(this.bag[c],10),e={product:{id:c},count:d};b.push(e)}var f={items:b,address:this.address};a.save(f,function(a){return function(){a.currentOrderSent=!0,a.getPendingOrders()}}(this))},c(function(a){return function(){a.getPendingOrders()}}(this),500)}])}(),function(){"use strict";angular.module("products-services",["ngResource"]).factory("ProductsFactory",["$resource",function(a){return a("shop/products/:id")}]).service("ProductsService",["ProductsFactory",function(a){this.products=[],a.query(function(a){return function(b){angular.forEach(b,function(b){a.products.push(b)})}}(this)),this.getProducts=function(){return this.products}}])}(),angular.module("shared",["ngCookies"]).service("cookieHandler",["$rootScope","$window","$cookies",function(a,b,c){this.get=function(a){return c[a]},this.unset=function(a){delete c[a]}}]).service("StringUtils",[function(){this.trim=function(a){return a?a.replace(/^\s+/g,"").replace(/\s+$/,""):""},this.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)}}]),function(){"use strict";angular.module("address-app",["orders-services"]).directive("validcreditcard",["StringUtils",function(a){return{scope:"=",require:"ngModel",link:function(b,c,d,e){var f={matches:function(a){return a?a.match(/^[\d+]{4}\-[\d+]{4}\-[\d+]{4}\-[\d+]{4}$/):!1},format:function(a){if(!a)return"";for(var b=a.replace(/[^0-9]+/g,""),c="",d=1;d<=b.length;d++)c+=b.charAt(d-1),d%4===0&&d<b.length&&(c+="-");return c}};e.$parsers.push(function(a){return function(b){if(!b)return"";b=a.format(b),e.$viewValue=b,e.$render();var c=a.matches(b);return e.$setValidity("creditcard",c),c?b:""}}(f)),e.$formatters.push(function(){return function(a){if(!a)return"";a=format(a);var b=b(a);return e.$setValidity("creditcard",b),b?a:""}}(f)),b.$watch("address.payment",function(c){c&&(c=a.trim(c)),"cash"===c?(e.$setValidity("creditcard",!0),b.address.creditcard=""):e.$setValidity("creditcard",b.address.creditcard&&16===b.address.creditcard.length)})}}}]).controller("AddressCtrl",["$scope","$location","OrdersService","StringUtils",function(a,b,c,d){a.address=c.address,a.payments={visa:"VISA",mastercard:"MasterCard",diners:"Diners",cash:"Cash"},a.creditCardSelected=function(){if(!a.address.payment)return!1;var b=d.trim(a.address.payment);return"cash"!=b},a.isBagEmpty=function(){return $.isEmptyObject(c.bag)},a.btnDisabled=function(){return a.addressForm.$invalid||a.isBagEmpty()},a.submit=function(){c.sendOrder(),b.path("/finish")},a.isAddressValid=function(){return a.addressForm.$valid},a.$watch("address",function(){c.setAddressValid(a.addressForm.$valid)},!0)}])}(),function(){"use strict";angular.module("finish-app",["products-services","orders-services"]).controller("FinishCtrl",["$scope","OrdersService","ProductsService",function(a,b,c){a.products=c.getProducts(),a.getProductName=function(b){var c=null;return angular.forEach(a.products,function(a){""+a.id==""+b&&(c=a.name)}),c},a.createProductsSummaryMessage=function(){var c="",d=b.getBag(),e=0;for(var f in d){e>0&&(c+=", ");var g=d[f];c+=g+"x "+a.getProductName(f),e++}return c+"."},a.createMessage=function(){return b.isBagEmpty()||!b.isAddressValid()?"Your bag is empty or the address invalid. Please add some pizzas to your bag and complete your address data.":b.isCurrentOrderSent()?"Thank you for your order. Here is the summary: "+this.createProductsSummaryMessage():"Your order hasn't been sent yet. Please press the 'Done!' button!"}}])}(),function(){"use strict";angular.module("orders-app",["orders-services"]).controller("OrdersCtrl",["$scope","OrdersService",function(a,b){a.orders=b.getPendingOrders()}])}(),function(){"use strict";angular.module("products-app",["products-services","orders-services"]).filter("nospaces",function(){return function(a){return a.replace(/\s+/g,"")}}).controller("ProductsCtrl",["$scope","ProductsService","OrdersService",function(a,b,c){a.products=b.getProducts(),a.bag=c.getBag()}])}(),function(){"use strict";angular.module("shopping-app",["ngRoute","wizard-components","validators","products-app","shoppingbag-app","address-app","finish-app","orders-app"]).config(["$httpProvider","$routeProvider","$locationProvider","$logProvider",function(a,b,c,d){a.interceptors.push(["$q",function(a){var b=function(a){var b=""+a;return 0===b.indexOf("4")||0===b.indexOf("5")};return{response:function(a){return a},responseError:function(c){return b(c.status)&&(location.href="login.jsp"),a.reject(c)}}}]);var e=d.$get;if(e&&e.length&&e.length>1&&"function"==typeof e[1]){var f=e[1],g=f(window),h=g.error;g.error=function(){if(arguments.length>0&&arguments[0].message){var a=new RegExp("missing hash prefix","g");if(a.test(""+arguments[0].message)){var b=[].concat(arguments).slice(1);b.unshift("MISSING HASH PREFIX ISSUE: "+arguments[0].message),g.log.apply(g,b)}else h.apply(g,arguments)}},d.$get=["$window",function(a){return function(){return a}}(g)]}b.when("/select",{templateUrl:"templates/products.html"}).when("/bag",{templateUrl:"templates/bag.html"}).when("/address",{templateUrl:"templates/address.html"}).when("/finish",{templateUrl:"templates/finish.html"}).when("/orders",{templateUrl:"templates/orders.html"}).otherwise({redirectTo:"/select"}),c.hashPrefix("!")}]).controller("AppCtrl",["$scope","OrdersService","cookieHandler","gettextCatalog","$http",function(a,b,c,d,e){a.getOrderCount=function(){return b.orders.length},a.changeLanguage=function(a){d.setCurrentLanguage(a)},a.setUserCredentials=function(b,d){c.get("login")?a.currentUser=c.get("login"):(a.currentUser=b,a.sessionId=d,e.defaults.headers.common.JSESSIONID=d,e.defaults.headers.common.login=b)}}])}(),function(){"use strict";angular.module("shoppingbag-app",["products-services","orders-services"]).controller("ShoppingBagCtrl",["$scope","OrdersService","ProductsService",function(a,b,c){a.products={},a.bag=b.getBag(),a.all=function(){var b=c.getProducts();a.products={};for(var d=0;d<b.length;d++){var e=b[d],f=e.id;a.products[""+f]=e}},a.getProductById=function(b){return a.products?a.products[b]:{}},a.getTotal=function(b){if(!a.products)return{};var c=a.getProductById(b);return c.price*a.bag[b]},a.getGrandTotal=function(){if(!a.bag)return 0;var b=0;for(var c in a.bag){var d=a.getProductById(c);b+=d.price*a.bag[c]}return b},a.init=function(){this.all()};var d=function(a){return function(b){if(b)for(var c in b)""===b[c]&&delete a.bag[c]}}(a);a.$watch("bag",function(a){d(a)},!0)}])}(),function(){"use strict";angular.module("validators",[]).directive("validnumber",function(){return{scope:"=",require:"ngModel",link:function(a,b,c,d){var e=function(a){if(!a)return 0;var b=a.replace(/[^0-9]*/g,"");return 0===b.length?0:parseInt(b,10)};d.$parsers.unshift(function(a){var b=e(a);return d.$setValidity("validnumber",!0),d.$viewValue=b,d.$render(),b}),d.$formatters.unshift(function(a){var b=e(a);return d.$setValidity("validnumber",!0),b})}}})}(),function(){"use strict";angular.module("wizard-components",["orders-services"]).directive("wizard",["$rootScope","$location","OrdersService","StringUtils",function(a,b,c,d){return{scope:{c:"&"},controller:["$scope",function(e){e.pages=[{label:"Choose product",link:"#!/select",css:""},{label:"Your shopping bag",link:"#!/bag",css:""},{label:"Your address",link:"#!/address",css:""},{label:"Finish",link:"#!/finish",css:""},{label:"Orders",link:"#!/orders",css:""}],e.isOrdersTab=function(a){return"Orders"==a},a.$on("$locationChangeSuccess",function(a,f){var g=b.path();angular.forEach(e.pages,function(a){a.css=g===a.link.replace(/^#!/,"")?"active":""}),(d.endsWith(f,"#!/select")||d.endsWith(f,"#!/bag")||d.endsWith(f,"#!/address"))&&c.isCurrentOrderSent()&&c.resetCurrentOrder()})}],restrict:"E",replace:!0,transclude:!0,template:'<div class="panel panel-default"><div class="panel-body"><ul class="nav nav-pills" role="tablist"><li role="presentation" ng-repeat="p in pages" ng-class="p.css"><a href="{{p.link}}">{{p.label | translate}}<span ng-if="isOrdersTab(p.label)"> ({{c()}})</span></a></li><ul></div></div>'}}])}(),angular.element(window).ready(function(){var a=$("#main");angular.module("pizzeria-app",["gettext","shopping-app"]).run(["gettextCatalog",function(a){a.setCurrentLanguage("en"),a.debug=!0}]),angular.bootstrap(a,["pizzeria-app"])}),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("de",{Amount:"Betrag",Count:"Anzahl",Date:"Datum","Done!":"Fertig!","First name":"Vorname","Go!":"Los!","Grand Total":"Gesamtbetrag",Login:"Login",Name:"Name",Password:"Passwort",Price:"Preis","Street / No.":"Stra&szlig;e / Hausnr.",Summary:"Zusammenfassung",Surname:"Nachname",Total:"Gesamt","Your payment method":"Ihre Zahlungsmethode","ZIP / City":"PLZ / Ort","My Awesome Pizzeria":"Meine perfekte Pizzeria","Please, use this wizard to order some pizzas.":"Bitte, folgen Sie unserem Wizard um Pizzen auszuw&auml;hlen.","Choose product":"Produkt auswählen","Your shopping bag":"Ihr Einkaufskorb","Your address":"Ihre Lieferadresse",Finish:"Fertig",Orders:"Bisherige Bestellungen",Margharita:"Margharita",Cardinale:"Cardinale",Prosciuto:"Prosciuto",Tonno:"Tonno","Quattro Stagioni":"Quattro Stagioni","Family Pizza":"Familien-Pizza","Your bag is empty or the address invalid. Please add some pizzas to your bag and complete your address data.":"Ihr Einkaufskorb ist leer oder die Adresse nicht korrekt. Bitte, fügen Sie Pizzen hinzu bzw. vervollständigen Sie die Adresse.",User:"Benutzer",Logout:"Ausloggen",VISA:"VISA",MasterCard:"MasterCard",Diners:"Diners",Cash:"Bar bei Lieferung","Thank you for your order. Here is the summary: ":"Danke für Ihre Bestellung. Hier ist die Zusammenfassung: ",German:"Deutsch",English:"Englisch","No orders so far.":"Es gibt noch keine Bestelungen.","Please, add some pizzas to your bag.":"Bitte, f&uuml;gen Sie Pizzen Ihrem Warenkorb hinzu.","all rights reserved":"alle Rechte vorbehalten","Your order hasn't been sent yet. Please press the 'Done!' button!":"Ihre Bestellung ist noch offen. Bestätigen Sie Ihre mit 'Fertig!'."})}]);